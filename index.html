<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML Layout playground</title>
    <style>
        table {
            font-family: monospace;
            font-size: 15.95px; /* This makes the width to be almost exactly 10px */
        }
        #prototypeTable {
            display: none;
        }
        td {
            /* border-width will be set at runtime*/
            border-style: solid;
            border-color: black;
            margin: 0;
            padding: 0;
            border-collapse: collapse;
        }
        .container {
            margin-bottom: 20px;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="getRandomTableMatrix.js"></script>
    <script src="autoLayout.js"></script>
</head>
<body>
    <table id="prototypeTable" contenteditable  cellspacing="0" cellpadding="0">
        <caption><h2>Automatic Browser Layout</h2></caption>
        <colgroup></colgroup>
        <tbody></tbody>
    </table>
    <div id="browserTableContainer" class="container">
        <button onclick="buildManualLayoutTable()">Copy table without layout</button>
        <!-- Table will come here -->
    </div>

    <div id="manualTableContainer" class="container">
        <button id="btnLayout" onclick="doLayout()" style="display:none">Do layout</button>
        <!-- Table will come here -->
    </div>
</body>
<script>
    //stands for 'Random integer in range'
    function riir(min, max) {
        return min + Math.floor(Math.random() * (max - min + 1));
    }

    function getRandomInputs() {
        /*return {
            n: 1,
            m: 1,
            availableTableWidth: 100
        };*/
        const n = riir(1, 6);  //Number of rows
        const m = riir(1, 10);  //Number of columns
        const availableTableWidth = riir(80, 140);
        return { n, m, availableTableWidth };
    }

    const inputs = getRandomInputs();
    const tableMatrix = getRandomTableMatrix(inputs.n, inputs.m);

    const charPixelWidth = 8.8;
    const CELL_BORDER_WIDTH = 1;    //
    const APixelWidth = (inputs.availableTableWidth * charPixelWidth) + CELL_BORDER_WIDTH * 2 * inputs.m;

    function createTableFromMatrix(tableMatrix, id, containerSelector, width = null) {
        $(`#${id}`).remove();
        const $newTable = $('#prototypeTable').clone().attr('id', id).appendTo(containerSelector);
        tableMatrix[0].forEach(cell => {
            $newTable.find(`colgroup`).append('<col/>');
        });
        tableMatrix.forEach(row => {
            const newTr$ = $('<tr>');
            row.forEach(cell => {
                const newTd$ = $(`<td>${cell}</td>`);
                newTd$.css('border-width', CELL_BORDER_WIDTH);
                newTr$.append(newTd$)
            });
            $newTable.find('tbody').append(newTr$);
        });
        if(width !== null) {
            $newTable.width(width);
        }
        console.log('table created, id: ', id);
    }

    createTableFromMatrix(tableMatrix, 'browserTable', '#browserTableContainer', APixelWidth);
    const autoBrowserWidths = $('#browserTable tr:first td').map( (i, el) => $(el).width() ).get();
    console.log({ autoBrowserWidths });

    function buildManualLayoutTable() {
        createTableFromMatrix(tableMatrix, 'manualTable', '#manualTableContainer');
        $('#manualTable caption h2').text('Manual (algorithm) layout');
        $('#manualTable colgroup col').width(APixelWidth/inputs.m);
        $('#btnLayout').show();
    }
    buildManualLayoutTable();

    function doLayout() {
        const columnWidths = autoLayout(tableMatrix, inputs.availableTableWidth);
        console.log('Widths: ', columnWidths);
        console.log('Widths in pixels', columnWidths.map(cw => cw * charPixelWidth));
        console.log('Total width: ', columnWidths.reduce((acum, curr) => acum + curr, 0));
        console.log('Total width in pixels: ', columnWidths.map(cw => cw * charPixelWidth).reduce((acum, curr) => acum + curr, 0));
        columnWidths.forEach((cw, j) => {
            $(`#manualTable colgroup col:eq(${j})`).width(cw * charPixelWidth + CELL_BORDER_WIDTH * 2);
        });
    }
</script>
</html>