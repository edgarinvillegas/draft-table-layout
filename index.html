<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML Layout playground</title>
    <style>
        table {
            font-family: Consolas;
        }
        td {
            border-width: 1px;
            border-style: solid;
            border-color: black;
            margin: 0;
            padding: 0;
            border-collapse: collapse;
        }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="getRandomTableMatrix.js"></script>
    <script src="autoLayout.js"></script>
</head>
<body>
    <button onclick="buildManualLayoutTable()">Copy table without layout</button>
    <table id="browserTable" contenteditable  cellspacing="0" cellpadding="0">
        <caption><h2>Automatic Browser Layout</h2></caption>
    </table>
    <br/><br/><br/>
    <button id="btnLayout" onclick="doLayout()" style="display:none">Do layout</button>
</body>
<script>
    //stands for 'Random integer in range'
    function riir(min, max) {
        return min + Math.floor(Math.random() * (max - min + 1));
    }

    const n = riir(1, 6);  //Number of rows
    const m = riir(1, 10);  //Number of columns

    const availableTableWidth = riir(80, 140);
    const charPixelWidth = 8.8;
    const APixelWidth = (availableTableWidth * charPixelWidth) + 2*m;   // 2*m due to the borders

    const tableMatrix = getRandomTableMatrix(n, m);

    (function buildBrowserTable(){
        tableMatrix.forEach(row => {
            const newTr$ = $('<tr>');
            row.forEach(cell => {
                const newTd$ = $(`<td>${cell}</td>`);
                newTr$.append(newTd$)
            });
            $('#browserTable').append(newTr$);
        })
        $('#browserTable').width(APixelWidth);
    })();

    function buildManualLayoutTable(){
        $('#manualTable').remove();
        $('#browserTable').clone().attr('id', 'manualTable').appendTo('body');
        $('#manualTable caption h2').text('Manual layout table');
        $('#manualTable td').css('white-space', 'normal');
        $('#manualTable tr:first td').width(APixelWidth/m);
        $('#manualTable').width(APixelWidth);
        $('#btnLayout').show();
    };

    function doLayout() {
        const columnWidths = autoLayout(tableMatrix, availableTableWidth);
        console.log('Widths: ', columnWidths);
        console.log('Widths in pixels', columnWidths.map(cw => cw * charPixelWidth));
        columnWidths.forEach((cw, j) => {
            $(`#manualTable td:eq(${j})`).width(cw * charPixelWidth);
        });
    }
</script>
</html>